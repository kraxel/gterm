stages:
  - build
  - rpms
  - repo

.build_meson: &build_meson
  - mkdir build-meson
  - meson . build-meson
  - ninja-build -C build-meson

build_fedora:
  stage: build
  image: registry.gitlab.com/kraxel/rpm-package-builder:fedora
  before_script:
    - dnf builddep -y *.spec
  script:
    - *build_meson

build_centos8:
  stage: build
  image: registry.gitlab.com/kraxel/rpm-package-builder:centos8
  before_script:
    - dnf builddep -y *.spec
  script:
    - *build_meson

build_centos7:
  stage: build
  image: registry.gitlab.com/kraxel/rpm-package-builder:centos7
  before_script:
    - yum-builddep -y *.spec
  script:
    - *build_meson

include:
  - project: 'kraxel/rpm-package-builder'
    file: 'gitlab-ci-rpms-tito-devel.yml'

boot-aarch64:
  stage: rpms
  rules:
    - if: '$BUILD_AARCH64 == "yes"'
  trigger:
    project: kraxel/ec2-init-scripts
    branch: boot-aarch64
